<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>管理中心 - 图书管理系统</title>
    <link rel="stylesheet" href="../static/manage.css">
</head>
<body>
    <!-- 顶部导航 -->
    <nav class="admin-nav">
        <ul class="nav-list">
            <li><a href="home.html">首页</a></li>
            <li><a href="info.html">个人中心</a></li>
            <li class="logout"><a href="login.html">退出登录</a></li>
        </ul>
    </nav>

    <!-- 管理模块切换 -->
    <div class="management-tabs">
        <button class="tab-btn active" data-table="users">用户管理</button>
        <button class="tab-btn" data-table="borrows">借阅管理</button>
        <button class="tab-btn" data-table="fines">罚款管理</button>
    </div>

    <!-- 数据表格容器 -->
    <main class="data-container">
        <!-- 用户表格 -->
        <table id="users" class="data-table active">
            <thead>
                <tr>
                    <th>用户ID</th>
                    <th>用户名</th>
                    <th>邮箱</th>
                    <th>注册时间</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>1001</td>
                    <td>张三</td>
                    <td>zhangsan@example.com</td>
                    <td>2024-01-15</td>
                    <td>
                        <button class="edit-btn">编辑</button>
                        <button class="delete-btn">冻结</button>
                    </td>
                </tr>
                <!-- 更多用户数据 -->
            </tbody>
        </table>

        <!-- 借阅表格 -->
        <table id="borrows" class="data-table">
            <thead>
                <tr>
                    <th>书籍ID</th>
                    <th>书名</th>
                    <th>借阅人</th>
                    <th>借出日期</th>
                    <th>应还日期</th>
                    <th>状态</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>B001</td>
                    <td>JavaScript权威指南</td>
                    <td>李四</td>
                    <td>2024-03-01</td>
                    <td>2024-04-01</td>
                    <td><span class="status borrowing">借阅中</span></td>
                </tr>
                <!-- 更多借阅数据 -->
            </tbody>
        </table>

        <!-- 罚款表格 -->
        <table id="fines" class="data-table">
            <thead>
                <tr>
                    <th>订单号</th>
                    <th>用户名</th>
                    <th>金额</th>
                    <th>产生时间</th>
                    <th>状态</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>F202403001</td>
                    <td>王五</td>
                    <td>¥20.00</td>
                    <td>2024-03-15</td>
                    <td><span class="status unpaid">未支付</span></td>
                    <td><button class="resolve-btn">标记处理</button></td>
                </tr>
                <!-- 更多罚款数据 -->
            </tbody>
        </table>
    </main>

    <script>
        // 权限验证
        const isAdmin = localStorage.getItem('user_type') === '4';
        if (!isAdmin) {
            alert('请使用管理员账号登录');
            window.location.href = 'login.html';
        }

        // 动态加载数据
        function loadData(tableType) {
            fetch(`/api/manage/${tableType}`)
                .then(response => response.json())
                .then(data => {
                    const table = document.getElementById(tableType);
                    const tbody = table.querySelector('tbody');
                    tbody.innerHTML = '';

                    data.forEach(item => {
                        const row = document.createElement('tr');
                        if(tableType === 'users') {
                            row.innerHTML = `
                                <td>${item.id}</td>
                                <td>${item.name}</td>
                                <td>${item.PhoneNumber}</td>
                                <td>${item.registration_date}</td>
                                <td>
                                    <button class="edit-btn">编辑</button>
                                    <button class="delete-btn">${item.is_can_borrow ? '冻结' : '解冻'}</button>
                                </td>
                            `;
                        } else if(tableType === 'borrows') {
                            row.innerHTML = `
                                <td>${item.record_id}</td>
                                <td>${item.title}</td>
                                <td>${item.borrower_name}</td>
                                <td>${item.borrow_date}</td>
                                <td>${item.due_date}</td>
                                <td><span class="status ${item.status === '借阅中' ? 'borrowing' : 'returned'}">${item.status}</span></td>
                            `;
                        } else if(tableType === 'fines') {
                            row.innerHTML = `
                                <td>${item.fine_id}</td>
                                <td>${item.borrower_name}</td>
                                <td>¥${item.fine.toFixed(2)}</td>
                                <td>${item.borrow_date}</td>
                                <td><span class="status ${item.status === '未支付' ? 'unpaid' : 'paid'}">${item.status}</span></td>
                                <td><button class="resolve-btn">标记处理</button></td>
                            `;
                        }
                        tbody.appendChild(row);
                    });
                });
        }

        // 初始化加载用户数据
        loadData('users');

        // 表格切换事件
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const tableType = btn.dataset.table;
                loadData(tableType);
            });
        });

        // 冻结/解冻操作
        document.addEventListener('click', e => {
            if(e.target.classList.contains('delete-btn')) {
                const userId = e.target.closest('tr').querySelector('td:first-child').textContent;
                fetch(`/api/user/${userId}/toggle-status`, { method: 'POST' })
                    .then(() => loadData('users'));
            }
        });
    </script>

</body>
</html>
